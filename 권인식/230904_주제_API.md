# 230904 증권사 API



> ### 키움증권



[키움증권 | 대한민국 주식시장 점유율 1위](https://www.kiwoom.com/h/customer/download/VOpenApiInfoView)

키움 API URL

# 키움 Open API+ 란?

- 당사가 제공하는 Open API 서비스 명으로, 고객님이 직접 프로그래밍한 투자전략을 당사가 제공하는 모듈에 연결하여, 시세조회/잔고조회/주문 등을 할 수 있도록 제공하는 서비스 입니다.
- 기존 키움 Open API에 실시간 조건검색 제공, 실시간 등록/해지, DATA 수신 속도 개선 등 강력한 추가 기능을 제공하여 새롭게 오픈하였습니다.

| 구분                      | 내용                                                                                                                                                                               |
| ----------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 가능 상품                   | 주식/Kospi200선물/Kospi200옵션                                                                                                                                                         |
| 적용 수수료율                 | 영웅문4(HTS)와 동일                                                                                                                                                                    |
| 키움 Open API+<br>사용 요건   | 당사 계좌를 보유하고 HTS ID를 연결하신 고객님께서는 모두 이용 가능하며, ‘서비스 사용등록’ 탭에서 사용 등록 후 바로 이용 가능합니다.                                                                                                  |
| 키움 Open API+<br>자동해지 조건 | 3개월 단위로 OpenAPI 거래금액 없을 경우 매월 첫영업일에 자동으로 서비스가 해지됩니다.(해지 시 서비스 재등록 후 사용가능)<br>(예시) 4월28일 서비스 등록 후 미거래<br>~4월30일 미거래 : 연속1회/ ~5월31일 미거래 : 연속2회 / ~6월30일 미거래 : 연속3회 → 7월 1일 강제해지 처리 |

- # 키움 Open API+ 사용절차
  
  1. **1단계**사용신청
     
     Open API 서비스를 사용 신청합니다.
  
   2. **2단계**설치
  
    Open API 설치
  
   3. **3단계**제작
  
    OCX 탑재 프로그램 제작
  
   4. **4단계**테스트
  
    테스트 및 디버깅

# 1단계 Open API 사용신청 합니다.

- 키움 Open API+ 서비스 이용을 위하여는 사용 등록 신청이 필요합니다.

- 당사 "홈페이지 > 고객서비스 > 다운로드 > Open API > 키움 Open API+ > 서비스 사용 등록/해지"탭에서 사용등록이 가능합니다.
  
  # 2단계OpenAPI+ 모듈 다운로드 및 설치

- 사용 신청 후 키움 Open API+ 모듈을 다운로드 하여 설치합니다.
  
  # 3단계Open API OCX 탑재 프로그램 제작 및 KOA Studio 활용

- 키움 Open API+는 프로그램 개발 확장성을 고려하여 OCX 컨트롤로 제작 지원합니다.

- 사용자 편의에 따라 VB, 엑셀, 웹기반, MFC 등으로 프로그램 제작이 가능합니다.

- 데이터 요청 및 수신은 TR 서비스명을 검색한 후 OCX를 통해 API 함수를 호출하는 방식으로 진행합니다.

- 프로그램 제작 편의를 위해 개발가이드 및 KOA Studio를 제공하고 있습니다. 가이드 및 자료실에 게시 된 샘플, 교육 VOD를 활용하시면 개발 시 도움을 받으실 수 있습니다.
  
  **KOA Studio는?**

- Open API가 제공하는 함수와 이벤트 사용방법을 확인 할 수 있습니다.

- Open API가 설치된 디렉토리에 압축 해제하여 실행 할 수 있습니다. (ex : C:\OpenApi\KOAStudioSA.exe)

- 당사가 제공하는 TR의 목록과 정보를 간편하게 확인 할 수 있습니다.

- TR을 테스트할 수 있는 화면을 제공하며, 입력값을 확인 할 수 있습니다.

- 실시간 DATA의 ID값을 확인할 수 있습니다.

- 한글 명 검색기능이 있어 원하는 TR을 손쉽게 찾아볼 수 있습니다.

- 모의투자 서버에 접속하여 데이터들을 조회해볼 수 있습니다.
  
  # 4단계모의환경 테스트

- 프로그램 제작 및 테스트를 위해서 모의투자에 접속 할 수 있습니다.

- 제작한 프로그램의 디버깅과 테스트를 위하여 실 환경 적용 전 모의투자로 접속하여 충분한 테스트를 권고 드립니다.  
  모의투자 접속은 키움 Open API+ 로그인 창에서 ‘모의투자 접속’ 항목을 체크하고 로그인 하시면 됩니다.

- 모의투자는 별도의 신청이 필요하며 당사 "홈페이지 > 모의투자 > 상시모의투자 > 주식/선물옵션 > 안내" 에서 가능 합니다.



> ### 신한투자증권

나만의 전략시스템 구현!  
*신한i indi*

신한i 에서 제공하는 모든 데이터를 조회, 가공하여  
자신만의 전략시스템을 구현할 수 있는 트레이딩입니다.

- [신한i indi](https://www.shinhansec.com/siw/customer-center/channel/channel_homeTrading-indi/contents.do)
- [사용신청/해지](https://www.shinhansec.com/siw/customer-center/channel/750601/view.do)
- [이용안내](https://www.shinhansec.com/siw/customer-center/channel/channel_homeTrading-indi_faq/contents.do)

### 신한i indi

#### 주요기능

- **모든 데이터 조회 가능**
  - 신한i에서 제공하는 주식, 선물 옵션(야간 및 상품거래 포함). 해외선물의 실시간 및 과거 데이터 조회/가공
- **Active X component 기반의 표준 인터페이스 제공**
  - Active X component 기반의 표준 인터페이스를 제공하므로 Microsoft 개발 플랫폼(VC++, VB, 등), MS Office 제품군 (MS-Excel, MS-Word, 등),  
    Web에서 손쉽게 실시간 데이터를 제공 받을 수 있음

#### 사용 안내

신한i indi 사용하기 위한 절차는 아래와 같습니다.

1. **계좌개설**

2. **ID 등록  
   [ID 등록하기](https://www.shinhansec.com/siw/customer-center/id/760001/view.do)**

3. **신한i indi 사용계약서 신청**

4. **신한i indi 관련 파일 다운로드**
   
   - 예제파일 및 사용자 인터페이스 문서 등

5. **고객별 주문 프로그램 작성 및 실행**
   
   - 고객이 직접 제작
- 기존에 신한i indi를 사용하고 계신 고객 분은 다시 한번 신한i indi 사용계약서 신청을 부탁 드립니다.

#### 사용방법

##### 신한i indi 프로그램 다운로드 및 설정

1. **거래 목적에 맞는 인디 프로그램 다운로드**
   
   - 주식/선물옵션 설치 프로그램
   - 해외선물용 설치 프로그램

2. **신한i indi가 정상적으로 접속되면 아래와 같이 Tray icon이 생성됩니다.**
   
   ![신한i indi Tray icon이 생성](https://www.shinhansec.com/siw/common/images/customer/img_homeTrading-indi02.jpg)

#### 다운로드

|                                                                                                                                                                                                                                                    |                                                                                                                                                         |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 다운로드                                                                                                                                                                                                                                               | 주식/선물옵션 설치 프로그램 : IndiSetup.exe (9.43 MB)[다운로드](https://file.shinhaninvest.com/filedoc/download/IndiSetup.exe "새창열림(신한i indi - 주식/선물옵션 설치 프로그램 다운로드)")  |
| 해외선물용 설치 프로그램 : IndiGXSetup.exe (9.20 MB)[다운로드](https://file.shinhaninvest.com/filedoc/download/IndiGXSetup.exe "새창열림(신한i indi - 해외선물용 설치 프로그램 다운로드)")                                                                                             |                                                                                                                                                         |
| 시스템 설치 최소 사양                                                                                                                                                                                                                                       | - 시스템 권장사양 : 팬티엄 3 이상 / 메모리 128MB 이상<br>- 운영체제(OS) : Windows 98 이상<br>- 해상도 : 1024x768 모드 최적(디스플레이 등록정보에서 글꼴 크기가 '작은글꼴'로 설정되어야 합니다.)<br>- 네트워크 : LAN 환경 |
| 자료실                                                                                                                                                                                                                                                | C#[선물시세 주문 예제 다운](https://file.shinhaninvest.com/filedoc/indi/sample/indi_csharp.zip "새창열림(선물시세 주문 예제 다운)")                                             |
| GX[특수고객 Interface 사양서](https://www.shinhansec.com/siw/customer-center/channel/channel_homeTrading-indi/contents.do# "새창열림(특수고객 Interface 사양서 다운)")[GX 예제](https://file.shinhaninvest.com/filedoc/indi/sample/indi_gx_example.zip "새창열림(GX 예제 다운)") |                                                                                                                                                         |
| MFC[MFC 예제](https://file.shinhaninvest.com/filedoc/indi/sample/indi_mfc.zip "새창열림(MFC 예제 다운)")                                                                                                                                                     |                                                                                                                                                         |
| Visual Basic[VB 예제](https://file.shinhaninvest.com/filedoc/indi/sample/indi_VB.zip "새창열림(엑셀 예제)")                                                                                                                                                  |                                                                                                                                                         |
| Excel[엑셀 예제](https://file.shinhaninvest.com/filedoc/indi/sample/indi_excel.zip "새창열림(엑셀 예제)")                                                                                                                                                      |                                                                                                                                                         |
| Python 예제[Python 예제](https://file.shinhaninvest.com/filedoc/indi/sample/PythonExample.zip "새창열림(엑셀 예제)")                                                                                                                                           |                                                                                                                                                         |
| 특수고객 Interface 사양서특수고객 Interface 사양서                                                                                                                                                                                                               |                                                                                                                                                         |

신한 i indi

python 예제코드

```python
import sys
from PyQt5.QtGui import *
from PyQt5.QtCore import *
from PyQt5.QAxContainer import *
from PyQt5.QtWidgets import QApplication
from PyQt5.QtWidgets import QMainWindow
from PyQt5.QtWidgets import QPushButton
from PyQt5.QtWidgets import QLineEdit
from pandas import Series, DataFrame
import pandas as pd
import numpy as np

'''
    신한아이 인디 국내주식 예제입니다:
    코드를 입력하시고 Search 버튼을 누르시면
    종목코드에 해당하는 일별 차트 데이터 100개와
    종목 가격정보를 조회하여 출력합니다.
'''

class IndiWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("IndiExample")

        self.IndiTR = QAxWidget("GIEXPERTCONTROL.GiExpertControlCtrl.1")
        self.IndiTR.ReceiveData.connect(self.ReceiveData)
        self.IndiTR.ReceiveSysMsg.connect(self.ReceiveSysMsg)

        self.IndiReal = QAxWidget("GIEXPERTCONTROL.GiExpertControlCtrl.1")
        self.IndiReal.ReceiveRTData.connect(self.ReceiveRTData)

        self.rqidD = {}
        PriceInfodt = np.dtype([('Symbol', 'S10'), ('Name', 'S40'), ('Close', 'f'), ('Open', 'f'), ('High', 'f'), ('Low', 'f'),
                       ('UpLimit', 'f'), ('DownLimit', 'f'), ('PrevClose', 'f'), ('Ask1', 'f'), ('Bid1', 'f'),
                       ('Time', 'S6'), ('Vol', 'u4'), ('ContQty', 'u4'), ('Ask1Qty', 'u4'), ('Bid1Qty', 'u4')])
        self.PriceInfo = np.empty([1], dtype=PriceInfodt)

        Historicaldt = np.dtype([('Date', 'S8'), ('Time', 'S6'), ('Open', 'f'), ('High', 'f'), ('Low', 'f'), ('Close', 'f'), ('Vol', 'u4')])
        self.Historical = np.empty([100], dtype=Historicaldt)

        self.MainSymbol = ""
        self.edSymbol = QLineEdit(self)
        self.edSymbol.setGeometry(20, 20, 60, 20)
        self.edSymbol.setText("")

        btnResearch = QPushButton("Search", self)
        btnResearch.setGeometry(85, 20, 50, 20)
        btnResearch.clicked.connect(self.btn_Search)


    def btn_Search(self):
        Symbol = self.edSymbol.text()

        # 기존종목 실시간 해제
        if self.MainSymbol != "":
            self.IndiReal.dynamicCall("UnRequestRTReg(QString, QString)", "SB", self.MainSymbol)
            self.IndiReal.dynamicCall("UnRequestRTReg(QString, QString)", "SC", self.MainSymbol)
            self.IndiReal.dynamicCall("UnRequestRTReg(QString, QString)", "SH", self.MainSymbol)

        self.MainSymbol = Symbol

        # 차트조회
        ret = self.IndiTR.dynamicCall("SetQueryName(QString)", "TR_SCHART")
        ret = self.IndiTR.dynamicCall("SetSingleData(int, QString)", 0, self.MainSymbol)
        ret = self.IndiTR.dynamicCall("SetSingleData(int, QString)", 1, "D")
        ret = self.IndiTR.dynamicCall("SetSingleData(int, QString)", 2, "1")
        ret = self.IndiTR.dynamicCall("SetSingleData(int, QString)", 3, "00000000")
        ret = self.IndiTR.dynamicCall("SetSingleData(int, QString)", 4, "99999999")
        ret = self.IndiTR.dynamicCall("SetSingleData(int, QString)", 5, "100")
        rqid = self.IndiTR.dynamicCall("RequestData()")

        self.rqidD[rqid] =  "TR_SCHART"

        # 종목 기본정보 조회
        ret = self.IndiTR.dynamicCall("SetQueryName(QString)", "SB")
        ret = self.IndiTR.dynamicCall("SetSingleData(int, QString)", 0, self.MainSymbol)
        rqid = self.IndiTR.dynamicCall("RequestData()")

        self.rqidD[rqid] = "SB"

        # 종목 현재가 조회
        ret = self.IndiTR.dynamicCall("SetQueryName(QString)", "SC")
        ret = self.IndiTR.dynamicCall("SetSingleData(int, QString)", 0, self.MainSymbol)
        rqid = self.IndiTR.dynamicCall("RequestData()")

        self.rqidD[rqid] = "SC"

        # 종목 호가 조회
        ret = self.IndiTR.dynamicCall("SetQueryName(QString)", "SH")
        ret = self.IndiTR.dynamicCall("SetSingleData(int, QString)", 0, self.MainSymbol)
        rqid = self.IndiTR.dynamicCall("RequestData()")

        self.rqidD[rqid] = "SH"

    def ReceiveData(self, rqid):

        TRName = self.rqidD[rqid]
        if TRName == "TR_SCHART" :
            nCnt = self.IndiTR.dynamicCall("GetMultiRowCount()")
            np.reshape(self.Historical, nCnt)
            for i in range(0, nCnt):
                self.Historical[i]['Date'] = self.IndiTR.dynamicCall("GetMultiData(int, int)", i, 0)
                self.Historical[i]['Time'] = self.IndiTR.dynamicCall("GetMultiData(int, int)", i, 1)
                self.Historical[i]['Open'] = self.IndiTR.dynamicCall("GetMultiData(int, int)", i, 2)
                self.Historical[i]['High'] = self.IndiTR.dynamicCall("GetMultiData(int, int)", i, 3)
                self.Historical[i]['Low'] = self.IndiTR.dynamicCall("GetMultiData(int, int)", i, 4)
                self.Historical[i]['Close'] = self.IndiTR.dynamicCall("GetMultiData(int, int)", i, 5)
                self.Historical[i]['Vol'] = self.IndiTR.dynamicCall("GetMultiData(int, int)", i, 9)

            print(self.Historical)

        elif TRName == "SB":
            self.PriceInfo[0]['Name'] = self.IndiTR.dynamicCall("GetSingleData(int)", 6)
            self.PriceInfo[0]['PrevClose'] = self.IndiTR.dynamicCall("GetSingleData(int)", 23)
            self.PriceInfo[0]['UpLimit'] = self.IndiTR.dynamicCall("GetSingleData(int)", 27)
            self.PriceInfo[0]['DownLimit'] = self.IndiTR.dynamicCall("GetSingleData(int)", 28)

            # 실시간 등록
            ret = self.IndiReal.dynamicCall("RequestRTReg(QString, QString)", "SB", self.MainSymbol)
        elif TRName == "SC":
            self.PriceInfo[0]['Symbol'] = self.IndiTR.dynamicCall("GetSingleData(int)", 1)
            self.PriceInfo[0]['Time'] = self.IndiTR.dynamicCall("GetSingleData(int)", 2)
            self.PriceInfo[0]['Close'] = self.IndiTR.dynamicCall("GetSingleData(int)", 3)
            self.PriceInfo[0]['Vol'] = self.IndiTR.dynamicCall("GetSingleData(int)", 7)
            self.PriceInfo[0]['ContQty'] = self.IndiTR.dynamicCall("GetSingleData(int)", 9)
            self.PriceInfo[0]['Open'] = self.IndiTR.dynamicCall("GetSingleData(int)", 10)
            self.PriceInfo[0]['High'] = self.IndiTR.dynamicCall("GetSingleData(int)", 11)
            self.PriceInfo[0]['Low'] = self.IndiTR.dynamicCall("GetSingleData(int)", 12)

            # 실시간 등록
            ret = self.IndiReal.dynamicCall("RequestRTReg(QString, QString)", "SC", self.MainSymbol)
        elif TRName == "SH":
            self.PriceInfo[0]['Ask1'] = self.IndiTR.dynamicCall("GetSingleData(int)", 4)
            self.PriceInfo[0]['Bid1'] = self.IndiTR.dynamicCall("GetSingleData(int)", 5)
            self.PriceInfo[0]['Ask1Qty'] = self.IndiTR.dynamicCall("GetSingleData(int)", 6)
            self.PriceInfo[0]['Bid1Qty'] = self.IndiTR.dynamicCall("GetSingleData(int)", 7)

            # 실시간 등록
            ret = self.IndiReal.dynamicCall("RequestRTReg(QString, QString)", "SH", self.MainSymbol)

        self.rqidD.__delitem__(rqid)
    def ReceiveRTData(self, RealType):

        if RealType == "SC":
            self.PriceInfo[0]['Symbol'] = self.IndiReal.dynamicCall("GetSingleData(int)", 1)
            self.PriceInfo[0]['Time'] = self.IndiReal.dynamicCall("GetSingleData(int)", 2)
            self.PriceInfo[0]['Close'] = self.IndiReal.dynamicCall("GetSingleData(int)", 3)
            self.PriceInfo[0]['Vol'] = self.IndiReal.dynamicCall("GetSingleData(int)", 7)
            self.PriceInfo[0]['ContQty'] = self.IndiReal.dynamicCall("GetSingleData(int)", 9)
            self.PriceInfo[0]['Open'] = self.IndiReal.dynamicCall("GetSingleData(int)", 10)
            self.PriceInfo[0]['High'] = self.IndiReal.dynamicCall("GetSingleData(int)", 11)
            self.PriceInfo[0]['Low'] = self.IndiReal.dynamicCall("GetSingleData(int)", 12)

        elif RealType == "SB":
            self.PriceInfo[0]['Name'] = self.IndiReal.dynamicCall("GetSingleData(int)", 5)
            self.PriceInfo[0]['PrevClose'] = self.IndiReal.dynamicCall("GetSingleData(int)", 23)
            self.PriceInfo[0]['UpLimit'] = self.IndiReal.dynamicCall("GetSingleData(int)", 27)
            self.PriceInfo[0]['DownLimit'] = self.IndiReal.dynamicCall("GetSingleData(int)", 28)
        elif RealType == "SH":
            self.PriceInfo[0]['Ask1'] = self.IndiReal.dynamicCall("GetSingleData(int)", 4)
            self.PriceInfo[0]['Bid1'] = self.IndiReal.dynamicCall("GetSingleData(int)", 5)
            self.PriceInfo[0]['Ask1Qty'] = self.IndiReal.dynamicCall("GetSingleData(int)", 6)
            self.PriceInfo[0]['Bid1Qty'] = self.IndiReal.dynamicCall("GetSingleData(int)", 7)

        print(self.PriceInfo[0])

    def ReceiveSysMsg(self, MsgID):
        print("System Message Received = ", MsgID)

if __name__ == "__main__":
    app = QApplication(sys.argv)
    IndiWindow = IndiWindow()
    IndiWindow.show()
    app.exec_()


```


